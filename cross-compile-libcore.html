<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <meta http-equiv="X-Frame-Options" content="sameorigin">
  
  

  <title>
    Cross Compiling: libcore &middot; Writing an OS in Rust
  </title>

  <link rel="canonical" href="http://os.phil-opp.com/cross-compile-libcore.html">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/syntax.css">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/images/favicon.ico">

  

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-65296949-1', 'auto');
  ga('send', 'pageview');

</script>

</head>

<body>
<div class="container content">

<header class="masthead">
  <h3 class="masthead-title">
    <a href="/" title="Home">Writing an OS in Rust</a>
    <span class="navigation">
      <small><a href="/atom.xml"><img src="/images/feed-icon.png" alt="RSS"></a></small>
    </span>
    <small>Philipp&nbsp;Oppermann's&nbsp;blog</small>
  </h3>
</header>

<main>


<article class="post">
  <h1 class="post-title">Cross Compiling: libcore</h1>

  

<p>So you&rsquo;re getting an <code>error: can't find crate for `core` [E0463]</code> when using <code>--target x86_64-unknown-linux-gnu</code>. That means that you&rsquo;re not running Linux or not using using a x86_64 processor.</p>

<p><strong>If you have an x86_64 processor and want a quick fix</strong>, try it with <code>x86_64-pc-windows-gnu</code> or <code>x86_64-apple-darwin</code> (or simply omit the explicit <code>--target</code>).</p>

<p>The idiomatic alternative and the only option for non x86_64 CPUs is described below. Note that you need to <a href="/cross-compile-binutils.html">cross compile binutils</a>, too.</p>

<h2 id="libcore">Libcore</h2>

<p>The core library is a dependency-free library that is added implicitly when using <code>#![no_std]</code>. It provides basic standard library features like Option or Iterator. The core library is installed together with the rust compiler (just like the std library). But the installed libcore is specific to your architecture. If you aren&rsquo;t working on x86_64 Linux and pass <code>‑‑target x86_64‑unknown‑linux‑gnu</code> to cargo, it can&rsquo;t find a x86_64 libcore. To fix this, you can either download it or build it using cargo.</p>

<h2 id="download-it">Download it</h2>

<p>You need to download the 64-bit Linux Rust build corresponding to your installed nightly. You can either just update to the current nightly and download the current nightly source <a href="https://www.rust-lang.org/downloads.html">here</a>. Or you retrieve your installed version through <code>rustc --version</code> and search the corresponding subfolder <a href="http://static.rust-lang.org/dist/">here</a>.</p>

<p>After extracting it and you need to copy the <code>x86_64-unknown-linux-gnu</code> folder in <code>rust-std-x86_64-unknown-linux-gnu/lib/rustlib</code> to your local Rust installation. For multirust, the right target folder is <code>~/.multirust/toolchains/nightly/lib/rustlib</code>. That&rsquo;s it!</p>

<h2 id="build-it-using-cargo">Build it using cargo</h2>

<p>The alternative is to use cargo to build libcore. But this variant has one big disadvantage: You have to modify each crate you depend on because it needs to use the same libcore. So you can&rsquo;t just add a crates.io dependency anymore, you need to fork and modify it first.</p>

<p>If you want to build libcore anyway, you need its source code. You can either clone the <a href="https://github.com/rust-lang/rust">rust repository</a> (makes updates easy) or manually <a href="https://www.rust-lang.org/downloads.html">download the Rust source</a> (faster and less memory).</p>

<p>Now we create a new cargo project named <code>core</code>, but delete its <code>src</code> folder:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>cargo new core
rm -r core/src
</code></pre></div>

<p>Then we create a symbolic link named <code>src</code> to the <code>rust/src/libcore</code> of the Rust source code:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>ln -s ../rust/src/libcore core/src
</code></pre></div>

<p>To use our new libcore crate (instead of the one installed together with rust) in our OS, we need to add it as a local dependency in the <code>Cargo.toml</code>:</p>
<div class="highlight"><pre><code class="language-toml" data-lang="toml"><span></span><span class="p">...</span>
<span class="p">[</span><span class="n">dependencies</span><span class="p">.</span><span class="n">core</span><span class="p">]</span>
<span class="n">path</span> <span class="o">=</span> <span class="s">&quot;core&quot;</span>
</code></pre></div>

<p>Now cargo compiles libcore for all Rust targets automatically.</p>

</article>

</main>

<footer class="footer">
  <small>
    &copy;
    <time datetime="2016">2016</time>. All rights reserved.
    <a href="/contact.html">Contact</a>
  </small>
</footer>
</div>

</body>
</html>

